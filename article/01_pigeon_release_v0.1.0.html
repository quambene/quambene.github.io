<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pigeon Release v0.1.0 - quambene&#x27;s blog</title>


        <!-- Custom HTML head -->

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../showcases.html">Showcases</a></li><li class="chapter-item expanded affix "><a href="../skills.html">Skills</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../syntax_reminder/index.html"><strong aria-hidden="true">1.</strong> Syntax reminder</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_reminder/01_python.html"><strong aria-hidden="true">1.1.</strong> Python</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/02_typescript.html"><strong aria-hidden="true">1.2.</strong> Typescript</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/03_rust.html"><strong aria-hidden="true">1.3.</strong> Rust</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/04_go.html"><strong aria-hidden="true">1.4.</strong> Go</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/05_java.html"><strong aria-hidden="true">1.5.</strong> Java</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/06_c.html"><strong aria-hidden="true">1.6.</strong> C</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/07_cpp.html"><strong aria-hidden="true">1.7.</strong> C++</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/08_scheme.html"><strong aria-hidden="true">1.8.</strong> Scheme</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/09_dart.html"><strong aria-hidden="true">1.9.</strong> Dart</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/10_postgres.html"><strong aria-hidden="true">1.10.</strong> Postgres</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/11_markdown.html"><strong aria-hidden="true">1.11.</strong> Markdown</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/12_html.html"><strong aria-hidden="true">1.12.</strong> HTML</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/13_bash.html"><strong aria-hidden="true">1.13.</strong> Bash</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/14_css.html"><strong aria-hidden="true">1.14.</strong> CSS</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/15_vue.html"><strong aria-hidden="true">1.15.</strong> Vue</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/16_nginx.html"><strong aria-hidden="true">1.16.</strong> Nginx</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/17_angular.html"><strong aria-hidden="true">1.17.</strong> Angular</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/18_flutter.html"><strong aria-hidden="true">1.18.</strong> Flutter</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/19_react.html"><strong aria-hidden="true">1.19.</strong> React</a></li></ol></li><li class="chapter-item expanded "><a href="../article/index.html"><strong aria-hidden="true">2.</strong> Article</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../article/02_pigeon_release_v0.2.0.html"><strong aria-hidden="true">2.1.</strong> Pigeon Release v0.2.0</a></li><li class="chapter-item expanded "><a href="../article/01_pigeon_release_v0.1.0.html" class="active"><strong aria-hidden="true">2.2.</strong> Pigeon Release v0.1.0</a></li><li class="spacer"></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">quambene&#x27;s blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pigeon-release-v010-open-source-email-automation-written-in-rust"><a class="header" href="#pigeon-release-v010-open-source-email-automation-written-in-rust">Pigeon Release v0.1.0: Open source email automation written in Rust</a></h1>
<p>I found that email automation solutions like Mailchimp or ConvertKit are quite expensive. I was using Pigeon for my projects already a while ago, but figured it could be more useful as an open source project.</p>
<p><a href="https://github.com/quambene/pigeon-rs">Pigeon</a> is a command line tool based on the excellent libraries <a href="https://crates.io/crates/clap">clap</a>, <a href="https://crates.io/crates/connectorx">connectorx</a>, and <a href="https://crates.io/crates/polars">polars</a>.</p>
<p>Using clap, it is super easy to create a command line tool. Everything just boils down to a <code>match</code>ing exercise for all subcommands and command line arguments. Rust's <code>Option</code> shows its full power here. Et voilà, after hardcore <code>match</code>ing for a few hours, you will be gifted with a stable and production-ready application.</p>
<p>Let's take a look how you could use pigeon. For example, Pigeon queries all subscribers of your newsletter, creates a plaintext and html email from a template file, and delivers it to all of them:</p>
<pre><code class="language-bash">pigeon send-bulk \
    sender@your-domain.com \
    --receiver-query &quot;select email from user where newsletter_confirmed = true&quot; \
    --message-file &quot;message.yaml&quot; \
    --display \
    --assume-yes
</code></pre>
<p>Console output:</p>
<pre><code class="language-bash">&gt; Display query result: shape: (4, 1)
+------------------------------+
| email                        |
| ---                          |
| str                          |
+==============================+
| &quot;marie@curie.com&quot;            |
+------------------------------+
| &quot;alexandre@grothendieck.com&quot; |
+------------------------------+
| &quot;emmy@noether.com&quot;           |
+------------------------------+
| &quot;elie@cartan.com&quot;            |
+------------------------------+
&gt; Sending email to 4 receivers ...
marie@curie.com ... ok
alexandre@grothendieck.com ... ok
emmy@noether.com ... ok
elie@cartan.com ... ok
</code></pre>
<p>The database query is achieved via connectorx. I like the way how you get type safety but without having to define the types yourself. At first, connectorx queries a single row to convert the postgres/mysql/etc. schema to the corresponding Rust types. Then, the query result will be downloaded the Rust way: fast, efficient, and gentle to your RAM.</p>
<p>You could also get the relevant emails from a csv file using <code>--receiver-file</code> instead of <code>--receiver-query</code> in the command above. In both cases, the tabular data is handled with polars which is the Rust equivalent of Python's pandas for handling <code>DataFrames</code>. As an additional benefit, polars displays the tabular data in a clearly arranged way to your console.</p>
<p>Now let's assume you want to personalize your emails. You can use Pigeon's <code>--personalize</code> to achieve this:</p>
<pre><code class="language-bash">pigeon send-bulk \
    albert@einstein.com \
    --receiver-query &quot;select first_name, last_name, email from user where newsletter_confirmed = true&quot; \
    --message-file &quot;message.yaml&quot; \
    --personalize &quot;first_name&quot; &quot;last_name&quot; \
    --display
</code></pre>
<p>Console output:</p>
<pre><code class="language-bash">&gt; Display query result: shape: (4, 3)
+-------------+----------------+------------------------------+
| first_name  | last_name      | email                        |
| ---         | ---            | ---                          |
| str         | str            | str                          |
+=============+================+==============================+
| &quot;Marie&quot;     | &quot;Curie&quot;        | &quot;marie@curie.com&quot;            |
+-------------+----------------+------------------------------+
| &quot;Alexandre&quot; | &quot;Grothendieck&quot; | &quot;alexandre@grothendieck.com&quot; |
+-------------+----------------+------------------------------+
| &quot;Emmy&quot;      | &quot;Noether&quot;      | &quot;emmy@noether.com&quot;           |
+-------------+----------------+------------------------------+
| &quot;Elie&quot;      | &quot;Cartan&quot;       | &quot;elie@cartan.com&quot;            |
+-------------+----------------+------------------------------+
&gt; Display message file: MessageTemplate {
    message: Message {
        subject: &quot;Issue No. 1&quot;,
        text: &quot;Dear {first_name} {last_name},
            Welcome to my newsletter. We are doing hard sciences here.
            Sincerely, Albert Einstein&quot;,
        html: &quot;Dear {first_name} {last_name},
            Welcome to my newsletter. We are doing hard sciences here.
            Sincerely, Albert Einstein&quot;,
    },
}
&gt; Display emails: BulkEmail {
    emails: [
        Email {
            sender: &quot;albert@einstein.com&quot;,
            receiver: &quot;marie@curie.com&quot;,
            message: Message {
                subject: &quot;Issue No. 1&quot;,
                text: &quot;Dear Marie Curie,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
                html: &quot;Dear Marie Curie,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
                },
        },
        Email {
            sender: &quot;albert@einstein.com&quot;,
            receiver: &quot;alexandre@grothendieck.com&quot;,
            message: Message {
                subject: &quot;Issue No. 1&quot;,
                text: &quot;Dear Alexandre Grothendieck,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
                html: &quot;Dear Alexandre Grothendieck,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
            },
        },
        Email {
            sender: &quot;albert@einstein.com&quot;,
            receiver: &quot;emmy@noether.com&quot;,
            message: Message {
                subject: &quot;Issue No. 1&quot;,
                text: &quot;Dear Emmy Noether,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
                html: &quot;Dear Emmy Noether,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
            },
        },
        Email {
            sender: &quot;albert@einstein.com&quot;,
            receiver: &quot;elie@cartan.com&quot;,
            message: Message {
                subject: &quot;Issue No. 1&quot;,
                text: &quot;Dear Elie Cartan,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
                html: &quot;Dear Elie Cartan,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein&quot;,
            },
        },
    ],
}
&gt; Should an email be sent to 4 recipients? Yes (y) or no (n)
&gt;
</code></pre>
<p>That's it. Pigeon has some more handy features which you can check out on <a href="https://github.com/quambene/pigeon-rs">github</a> and it is on <a href="https://crates.io/crates/pigeon-rs">crates.io</a> as well.</p>
<p>Currently, Pigeon is based on AWS Simple Email Service as email provider which is why it is quite cheap to use. The following table compares the price per month for email provider and emails per month:</p>
<table><thead><tr><th> </th><th>5,000</th><th>10,000</th><th>100,000</th></tr></thead><tbody>
<tr><td><strong>Pigeon+</strong><a href="https://aws.amazon.com/ses/pricing/"><strong>AWS</strong></a></td><td>$4.50</td><td>$5</td><td>$14</td></tr>
<tr><td><a href="https://mailchimp.com/pricing/marketing/"><strong>Mailchimp Marketing</strong></a></td><td>$9.99</td><td>$20.99</td><td>$78.99</td></tr>
<tr><td><a href="https://mailchimp.com/pricing/transactional-email/"><strong>Mailchimp Transactional</strong></a></td><td>-</td><td>-</td><td>$80</td></tr>
<tr><td><a href="https://sendgrid.com/pricing/"><strong>Sendgrid Marketing</strong></a></td><td>$15</td><td>$15</td><td>$120</td></tr>
<tr><td><a href="https://sendgrid.com/pricing/"><strong>Sendgrid API</strong></a></td><td>$14.95</td><td>$14.95</td><td>$29.95</td></tr>
<tr><td><a href="https://convertkit.com/pricing"><strong>ConvertKit</strong></a></td><td>$66</td><td>$100</td><td>$516</td></tr>
</tbody></table>
<p>Currently, you have to connect your database and your email provider via environment variables which is not quite user-friendly. It's working for me quite well, but I would be interested in your feedback for potential improvements.</p>
<p>Edit: Polars is not exactly the Rust equivalent of Python's pandas. There is a Python version of polars, too. <a href="https://h2oai.github.io/db-benchmark/">Here</a> is a benchmark for both.</p>
<p><em>First published on <a href="https://www.reddit.com/r/rust/comments/qy85sg/pigeonrs_open_source_email_automation_written_in/">Reddit</a> (2021-11-20).</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../article/02_pigeon_release_v0.2.0.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../article/02_pigeon_release_v0.2.0.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
