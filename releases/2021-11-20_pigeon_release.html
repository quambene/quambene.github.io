<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pigeon Release v0.1.0 - quambene&#x27;s blog</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../projects.html">Projects</a></li><li class="chapter-item expanded affix "><a href="../skills.html">Skills</a></li><li class="chapter-item expanded affix "><a href="../about.html">About</a></li><li class="chapter-item expanded affix "><li class="spacer"></li><li class="chapter-item expanded "><a href="../releases/index.html"><strong aria-hidden="true">1.</strong> Releases</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../releases/2024-08-18_eric_release.html"><strong aria-hidden="true">1.1.</strong> Eric Release v0.4.1/v0.3.1</a></li><li class="chapter-item expanded "><a href="../releases/2023-09-01_bogrep_release.html"><strong aria-hidden="true">1.2.</strong> Bogrep Release v0.1.3</a></li><li class="chapter-item expanded "><a href="../releases/2022-01-05_pigeon_release.html"><strong aria-hidden="true">1.3.</strong> Pigeon Release v0.2.0</a></li><li class="chapter-item expanded "><a href="../releases/2022-04-29_libre_crm_release.html"><strong aria-hidden="true">1.4.</strong> LibreCRM Release v0.1.0</a></li><li class="chapter-item expanded "><a href="../releases/2021-11-20_pigeon_release.html" class="active"><strong aria-hidden="true">1.5.</strong> Pigeon Release v0.1.0</a></li></ol></li><li class="chapter-item expanded "><a href="../shortcuts.html"><strong aria-hidden="true">2.</strong> Shortcuts</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/index.html"><strong aria-hidden="true">3.</strong> Syntax reminder</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../syntax_reminder/python.html"><strong aria-hidden="true">3.1.</strong> Python</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/rust.html"><strong aria-hidden="true">3.2.</strong> Rust</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/go.html"><strong aria-hidden="true">3.3.</strong> Go</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/java.html"><strong aria-hidden="true">3.4.</strong> Java</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/c.html"><strong aria-hidden="true">3.5.</strong> C</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/cpp.html"><strong aria-hidden="true">3.6.</strong> C++</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/typescript.html"><strong aria-hidden="true">3.7.</strong> Typescript</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/dart.html"><strong aria-hidden="true">3.8.</strong> Dart</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/flutter.html"><strong aria-hidden="true">3.9.</strong> Flutter</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/html.html"><strong aria-hidden="true">3.10.</strong> HTML</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/css.html"><strong aria-hidden="true">3.11.</strong> CSS</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/vue.html"><strong aria-hidden="true">3.12.</strong> Vue</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/angular.html"><strong aria-hidden="true">3.13.</strong> Angular</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/react.html"><strong aria-hidden="true">3.14.</strong> React</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/postgres.html"><strong aria-hidden="true">3.15.</strong> Postgres</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/markdown.html"><strong aria-hidden="true">3.16.</strong> Markdown</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/bash.html"><strong aria-hidden="true">3.17.</strong> Bash</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/nginx.html"><strong aria-hidden="true">3.18.</strong> Nginx</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/git.html"><strong aria-hidden="true">3.19.</strong> Git</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/regex.html"><strong aria-hidden="true">3.20.</strong> Regex</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/protobuf.html"><strong aria-hidden="true">3.21.</strong> Protobuf</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/docker.html"><strong aria-hidden="true">3.22.</strong> Docker</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/fortran.html"><strong aria-hidden="true">3.23.</strong> Fortran</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/scheme.html"><strong aria-hidden="true">3.24.</strong> Scheme</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/erlang.html"><strong aria-hidden="true">3.25.</strong> Erlang</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/elixir.html"><strong aria-hidden="true">3.26.</strong> Elixir</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/clojure.html"><strong aria-hidden="true">3.27.</strong> Clojure</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/elm.html"><strong aria-hidden="true">3.28.</strong> Elm</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/ada.html"><strong aria-hidden="true">3.29.</strong> Ada</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/nim.html"><strong aria-hidden="true">3.30.</strong> Nim</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/zig.html"><strong aria-hidden="true">3.31.</strong> Zig</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/julia.html"><strong aria-hidden="true">3.32.</strong> Julia</a></li><li class="chapter-item expanded "><a href="../syntax_reminder/xml.html"><strong aria-hidden="true">3.33.</strong> XML</a></li></ol></li><li class="chapter-item expanded "><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">quambene&#x27;s blog</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pigeon-release-v010-open-source-email-automation-written-in-rust"><a class="header" href="#pigeon-release-v010-open-source-email-automation-written-in-rust">Pigeon Release v0.1.0: Open source email automation written in Rust</a></h1>
<p><em>First published on <a href="https://www.reddit.com/r/rust/comments/qy85sg/pigeonrs_open_source_email_automation_written_in/">Reddit</a> (2021-11-20).</em></p>
<p>I found that email automation solutions like Mailchimp or ConvertKit are quite expensive. I was using Pigeon for my projects already a while ago, but figured it could be more useful as an open source project.</p>
<p><a href="https://github.com/quambene/pigeon-rs">Pigeon</a> is a command line tool based on the excellent libraries <a href="https://crates.io/crates/clap">clap</a>, <a href="https://crates.io/crates/connectorx">connectorx</a>, and <a href="https://crates.io/crates/polars">polars</a>.</p>
<p>Using clap, it is super easy to create a command line tool. Everything just boils down to a <code>match</code>ing exercise for all subcommands and command line arguments. Rust's <code>Option</code> shows its full power here. Et voilà, after hardcore <code>match</code>ing for a few hours, you will be gifted with a stable and production-ready application.</p>
<p>Let's take a look how you could use pigeon. For example, Pigeon queries all subscribers of your newsletter, creates a plaintext and html email from a template file, and delivers it to all of them:</p>
<pre><code class="language-bash">pigeon send-bulk \
    sender@your-domain.com \
    --receiver-query "select email from user where newsletter_confirmed = true" \
    --message-file "message.yaml" \
    --display \
    --assume-yes
</code></pre>
<p>Console output:</p>
<pre><code class="language-bash">&gt; Display query result: shape: (4, 1)
+------------------------------+
| email                        |
| ---                          |
| str                          |
+==============================+
| "marie@curie.com"            |
+------------------------------+
| "alexandre@grothendieck.com" |
+------------------------------+
| "emmy@noether.com"           |
+------------------------------+
| "elie@cartan.com"            |
+------------------------------+
&gt; Sending email to 4 receivers ...
marie@curie.com ... ok
alexandre@grothendieck.com ... ok
emmy@noether.com ... ok
elie@cartan.com ... ok
</code></pre>
<p>The database query is achieved via connectorx. I like the way how you get type safety but without having to define the types yourself. At first, connectorx queries a single row to convert the postgres/mysql/etc. schema to the corresponding Rust types. Then, the query result will be downloaded the Rust way: fast, efficient, and gentle to your RAM.</p>
<p>You could also get the relevant emails from a csv file using <code>--receiver-file</code> instead of <code>--receiver-query</code> in the command above. In both cases, the tabular data is handled with polars which is the Rust equivalent of Python's pandas for handling <code>DataFrames</code>. As an additional benefit, polars displays the tabular data in a clearly arranged way to your console.</p>
<p>Now let's assume you want to personalize your emails. You can use Pigeon's <code>--personalize</code> to achieve this:</p>
<pre><code class="language-bash">pigeon send-bulk \
    albert@einstein.com \
    --receiver-query "select first_name, last_name, email from user where newsletter_confirmed = true" \
    --message-file "message.yaml" \
    --personalize "first_name" "last_name" \
    --display
</code></pre>
<p>Console output:</p>
<pre><code class="language-bash">&gt; Display query result: shape: (4, 3)
+-------------+----------------+------------------------------+
| first_name  | last_name      | email                        |
| ---         | ---            | ---                          |
| str         | str            | str                          |
+=============+================+==============================+
| "Marie"     | "Curie"        | "marie@curie.com"            |
+-------------+----------------+------------------------------+
| "Alexandre" | "Grothendieck" | "alexandre@grothendieck.com" |
+-------------+----------------+------------------------------+
| "Emmy"      | "Noether"      | "emmy@noether.com"           |
+-------------+----------------+------------------------------+
| "Elie"      | "Cartan"       | "elie@cartan.com"            |
+-------------+----------------+------------------------------+
&gt; Display message file: MessageTemplate {
    message: Message {
        subject: "Issue No. 1",
        text: "Dear {first_name} {last_name},
            Welcome to my newsletter. We are doing hard sciences here.
            Sincerely, Albert Einstein",
        html: "Dear {first_name} {last_name},
            Welcome to my newsletter. We are doing hard sciences here.
            Sincerely, Albert Einstein",
    },
}
&gt; Display emails: BulkEmail {
    emails: [
        Email {
            sender: "albert@einstein.com",
            receiver: "marie@curie.com",
            message: Message {
                subject: "Issue No. 1",
                text: "Dear Marie Curie,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
                html: "Dear Marie Curie,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
                },
        },
        Email {
            sender: "albert@einstein.com",
            receiver: "alexandre@grothendieck.com",
            message: Message {
                subject: "Issue No. 1",
                text: "Dear Alexandre Grothendieck,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
                html: "Dear Alexandre Grothendieck,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
            },
        },
        Email {
            sender: "albert@einstein.com",
            receiver: "emmy@noether.com",
            message: Message {
                subject: "Issue No. 1",
                text: "Dear Emmy Noether,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
                html: "Dear Emmy Noether,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
            },
        },
        Email {
            sender: "albert@einstein.com",
            receiver: "elie@cartan.com",
            message: Message {
                subject: "Issue No. 1",
                text: "Dear Elie Cartan,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
                html: "Dear Elie Cartan,
                    Welcome to my newsletter. We are doing hard sciences here.
                    Sincerely, Albert Einstein",
            },
        },
    ],
}
&gt; Should an email be sent to 4 recipients? Yes (y) or no (n)
&gt;
</code></pre>
<p>That's it. Pigeon has some more handy features which you can check out on <a href="https://github.com/quambene/pigeon-rs">github</a> and it is on <a href="https://crates.io/crates/pigeon-rs">crates.io</a> as well.</p>
<p>Currently, Pigeon is based on AWS Simple Email Service as email provider which is why it is quite cheap to use. The following table compares the price per month for email provider and emails per month:</p>
<div class="table-wrapper"><table><thead><tr><th> </th><th>5,000</th><th>10,000</th><th>100,000</th></tr></thead><tbody>
<tr><td><strong>Pigeon+</strong><a href="https://aws.amazon.com/ses/pricing/"><strong>AWS</strong></a></td><td>$4.50</td><td>$5</td><td>$14</td></tr>
<tr><td><a href="https://mailchimp.com/pricing/marketing/"><strong>Mailchimp Marketing</strong></a></td><td>$9.99</td><td>$20.99</td><td>$78.99</td></tr>
<tr><td><a href="https://mailchimp.com/pricing/transactional-email/"><strong>Mailchimp Transactional</strong></a></td><td>-</td><td>-</td><td>$80</td></tr>
<tr><td><a href="https://sendgrid.com/pricing/"><strong>Sendgrid Marketing</strong></a></td><td>$15</td><td>$15</td><td>$120</td></tr>
<tr><td><a href="https://sendgrid.com/pricing/"><strong>Sendgrid API</strong></a></td><td>$14.95</td><td>$14.95</td><td>$29.95</td></tr>
<tr><td><a href="https://convertkit.com/pricing"><strong>ConvertKit</strong></a></td><td>$66</td><td>$100</td><td>$516</td></tr>
</tbody></table>
</div>
<p>Currently, you have to connect your database and your email provider via environment variables which is not quite user-friendly. It's working for me quite well, but I would be interested in your feedback for potential improvements.</p>
<p>Edit: Polars is not exactly the Rust equivalent of Python's pandas. There is a Python version of polars, too. <a href="https://h2oai.github.io/db-benchmark/">Here</a> is a benchmark for both.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../releases/2022-04-29_libre_crm_release.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../shortcuts.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../releases/2022-04-29_libre_crm_release.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../shortcuts.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
